<div class="container">
  <div class="back-link mt-5">
    <a routerLink="/products" class="text-decoration-none text-muted">
      <i class="bi bi-arrow-left"></i> Back to Products
    </a>
  </div>

  <div class="product-section row">
    <div class="product-image-col col-md-6 col-lg-6">
      <div class="image-gallery">
        <div class="main-image-wrapper">
          <ng-container [ngSwitch]="product.productMedias[currentImageIndex].mediaType">
            <img *ngSwitchCase="'Image'" [src]="getCurrentImage()"
              [alt]="product.name + ' - Image ' + (currentImageIndex + 1)" class="main-image">
            
          </ng-container>

          <div class="image-counter">
            {{ getCurrentImageNumber() }}/{{ getTotalImages() }}
          </div>

          <button class="nav-arrow prev" (click)="previousImage()" [disabled]="getTotalImages() <= 1">
            <i class="bi bi-chevron-left"></i>
          </button>
          <button class="nav-arrow next" (click)="nextImage()" [disabled]="getTotalImages() <= 1">
            <i class="bi bi-chevron-right"></i>
          </button>
        </div>

        <div class="thumbnail-gallery" *ngIf="getTotalImages() > 1">
          <ng-container *ngFor="let media of product.productMedias; let i = index">
            <div [ngSwitch]="media.mediaType" class="thumbnail-wrapper" [class.active]="isActiveImage(i)"
              (click)="selectImage(i)">
              <img *ngSwitchCase="'Image'" [src]="getProductImageUrl(media.mediaUrl)"
                [alt]=" product.name + ' - Image ' + (i + 1)" class="thumbnail-image">
              <div *ngSwitchCase="'Video'" class="video-container">
                <video [src]="getProductImageUrl(media.mediaUrl)" class="thumbnail-video"></video>
                <div class="play-overlay-thumbnail" *ngIf="videoStates[i]?.showIcon">
                  {{ videoStates[i].isPlaying ? '⏸' : '▶' }}
                </div>
              </div>
            </div>
          </ng-container>
        </div>

      </div>
    </div>

    <div class="product-info-col col-md-6 col-lg-6 ps-5">
      <div class="category-stock-row">
        <span class="badge badge-category">{{ category?.name }}</span>
        <span *ngIf="product.stockQuantity > 0" class="badge badge-in-stock">In Stock</span>
        <span *ngIf="product.stockQuantity === 0" class="badge badge-out-of-stock">Out of Stock</span>
      </div>

      <h1 class="product-name">{{ product.name }}</h1>

      <h2 class="product-price">{{ product.price | indianCurrency }}</h2>

      <div class="ratings-section mb-4">
        <div class="rating-summary">

          <div class="stars-container">
            <div class="rating">
              <span class="stars">
                <ng-container *ngFor="let star of product.avgRating | starRating">
                  <i class="star-icon" [ngClass]="{
                    'bi bi-star-fill': star === 'full',
                    'fas fa-star-half-stroke': star === 'half',
                    'far fa-star': star === 'empty'
                  }"></i>
                </ng-container>
              </span>
              <span class="rating-text">{{ product.avgRating }} out of 5 ({{ product.totalReviews }} reviews)</span>
            </div>
          </div>

          <i *ngIf="product.avgRating > 0" class="bi bi-chevron-down dropdown-arrow" (mouseenter)="showRatingModal = true" (mouseleave)="showRatingModal = false"></i>

          <div class="rating-modal" *ngIf="product.avgRating > 0" [class.show]="showRatingModal"
            (mouseenter)="showRatingModal = true" (mouseleave)="showRatingModal = false">
            <div class="modal-content">
              <div class="modal-header">
                <h4>Customer Reviews</h4>
                <button type="button" class="btn-close" (click)="showRatingModal = false">
                  <i class="bi bi-x"></i>
                </button>
              </div>
              <div class="modal-body">
                <app-customer-reviews [reviewData]="reviewData" [productId]="product.id.toString()"
                  [asModal]="true"></app-customer-reviews>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="description-section">
        <h6>Description</h6>
        <p class="description-text">
          {{ product.description }}
        </p>
      </div>

      <div class="buttons-row">
        <button class="btn btn-primary" (click)="onAddToCart()">
          <i class="bi bi-cart"></i> Add to Cart
        </button>
        <button class="btn btn-secondary">
          <i class="bi bi-heart"></i>
        </button>
        <button class="btn btn-secondary">
          <i class="bi bi-share"></i>
        </button>
      </div>
    </div>
  </div>
</div>